"use strict";(self.webpackChunknotebooksend=self.webpackChunknotebooksend||[]).push([[709],{709:(t,e,i)=>{i.r(e),i.d(e,{default:()=>L});var s=i(4901);const o="notebooksend",n="unianalytics";var l;!function(t){t.notebookId=`${n}_notebook_id`,t.instanceId=`${n}_instance_id`,t.cellMapping=`${n}_cell_mapping`}(l||(l={}));var d=i(6336);const c=async(t,e)=>{const i="https://api.unianalytics.ch/send/"+e,s=JSON.stringify(t);var o;if(s.length>1048576)console.log("Payload size exceeds limit of 1 Mb");else try{const t=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","Token-Auth":(o=JSON.stringify({token:"407b1e36627f49f28fe51d06233d9765",nonce:crypto.randomUUID()}),d.AES.encrypt(o,d.enc.Base64.parse("F0fbgrA8v9cqCHgzCgIOMou9CTYj5wTu"),{mode:d.mode.ECB}).toString())},body:s}),e=await t.json();return console.log(e),e}catch(t){return null}},r=t=>{console.log("Posting Cell Alteration :\n",t),c(t,"alter")},a=(t,e,i)=>{var s;return 4===i?null==t?void 0:t.getMetadata(e):null===(s=null==t?void 0:t.metadata)||void 0===s?void 0:s.get(e)},h=(t,e,i,s)=>{var o;4===s?null==t||t.setMetadata(e,i):null===(o=null==t?void 0:t.metadata)||void 0===o||o.set(e,i)},_=(t,e)=>4===e?Array.from(t).map((t=>t.id)):Array.from({length:t.length},((e,i)=>t.get(i).id)),u=(t,e)=>!(!t||t.isDisposed)&&a(t.context.model,l.notebookId,e)&&a(t.context.model,l.instanceId,e)&&a(t.context.model,l.cellMapping,e),p=t=>{let e=0;if("string"==typeof t)e=t.length;else if(Array.isArray(t))for(const i of t)e+=i.length;else for(const i in t)e+=JSON.stringify(t[i]).length;return e};class g{constructor(t,e,i){this._labShell=t,this._settingRegistry=e,this._jupyterVersion=i}createNew(t){return new C(t,this._labShell,this._settingRegistry,this._jupyterVersion)}}class C{constructor(t,e,i,s){this._onContentDisposed=t=>{t.activeCellChanged.disconnect(this._onCellChanged,this),t.disposed.disconnect(this._onContentDisposed,this)},this._onCellChanged=(t,e)=>{this._sendCellClick("OFF"),this._setActiveCellAndOrigCellId(e),this._focusON&&this._sendCellClick("ON")},this._setActiveCellAndOrigCellId=t=>{var e,i,s;this._lastActiveCellId=null==t?void 0:t.model.sharedModel.getId(),this._lastActiveCellId?this._lastOrigCellId=null===(s=null===(i=a(null===(e=this._panel)||void 0===e?void 0:e.model,l.cellMapping,this._jupyterVersion))||void 0===i?void 0:i.find((([t])=>t===this._lastActiveCellId)))||void 0===s?void 0:s[1]:this._lastOrigCellId=null},this._onNotebookChanged=t=>{t.currentWidget===this._panel?(this._isActive=!0,this._settingPromise.then((t=>{this.isDisposed||this._isActive&&!this._focusON&&(this._sendNotebookClick("ON"),this._sendCellClick("ON"),this._focusON=!0)}))):(this._focusON&&(this._sendNotebookClick("OFF"),this._sendCellClick("OFF")),this._focusON=!1,this._isActive=!1)},this._sendCellClick=t=>{if(this._lastActiveCellId&&this._isFocusSettingEnabled){let i=null;"ON"===t?(this._cellStart=new Date,i=null):i=((new Date).getTime()-this._cellStart.getTime())/1e3,this._lastOrigCellId&&(e={notebook_id:this._notebookId,instance_id:this._instanceId,cell_id:this._lastActiveCellId,orig_cell_id:this._lastOrigCellId,click_type:t,time:(new Date).toISOString(),click_duration:i},console.log("Posting Cell Click :\n",e),c(e,"clickevent/cell"))}var e},this._sendNotebookClick=t=>{if(this._isFocusSettingEnabled){let i=null;"ON"===t?(this._notebookStart=new Date,i=null):i=((new Date).getTime()-this._notebookStart.getTime())/1e3,e={notebook_id:this._notebookId,instance_id:this._instanceId,click_type:t,time:(new Date).toISOString(),click_duration:i},console.log("Posting Notebook Click :\n",e),c(e,"clickevent/notebook")}var e},this._focusON=!1,this._isActive=!1,this._isDisposed=!1,this._isFocusSettingEnabled=!1,this._notebookId=void 0,this._instanceId=void 0,this._lastActiveCellId=null,this._lastOrigCellId=null,this._notebookStart=new Date,this._cellStart=new Date,this._panel=t,this._jupyterVersion=s,this._settingPromise=i.load(`${o}:settings`),this._settingPromise.then((t=>{this._updateSettings(t),t.changed.connect(this._updateSettings.bind(this))}),(t=>{console.error(`${o}: Could not load settings, so did not activate: ${t}`)})),t.context.ready.then((()=>{u(t,s)&&(this._notebookId=a(t.context.model,l.notebookId,s),this._instanceId=a(t.context.model,l.instanceId,s),this._onCellChanged(t.content,t.content.activeCell),this._onNotebookChanged(e),t.content.activeCellChanged.connect(this._onCellChanged,this),e.currentChanged.connect(this._onNotebookChanged,this),t.content.disposed.connect(this._onContentDisposed,this))}))}_updateSettings(t){this._isFocusSettingEnabled=t.get("FocusExtension").composite}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._focusON&&(this._sendNotebookClick("OFF"),this._sendCellClick("OFF")),this._focusON=!1,this._isActive=!1,this._isDisposed=!0,this._panel=null,this._notebookId=null,this._instanceId=null,this._lastActiveCellId=null,s.Signal.clearData(this))}}var f,y=i(829),m=i(7930),b=i(9500);class v{constructor(t,e){this._settingRegistry=t,this._jupyterVersion=e}createNew(t){return new k(t,this._settingRegistry,this._jupyterVersion)}}class k{constructor(t,e,i){this._isDisposed=!1,this._notebookId=void 0,this._instanceId=void 0,this._isExecutionSettingEnabled=!1,this._panel=t,this._settingRegistry=e,this._jupyterVersion=i,e.load(`${o}:settings`).then((t=>{this._updateSettings(t),t.changed.connect(this._updateSettings.bind(this)),t.get("ExecutionExtension").composite&&this._settingRegistry.load("@jupyterlab/notebook-extension:tracker").then((t=>t.set("recordTiming",!0)),(t=>{console.error(`${o}: Could not force metadata recording: ${t}`)}))}),(t=>{console.error(`${o}: Could not load settings, so did not activate: ${t}`)})),t.context.ready.then((()=>{u(t,i)&&(this._notebookId=a(t.context.model,l.notebookId,i),this._instanceId=a(t.context.model,l.instanceId,i),y.NotebookActions.executed.connect(this._onCellExecuted,this),t.disposed.connect((()=>y.NotebookActions.executed.disconnect(this._onCellExecuted,this))))}))}_updateSettings(t){this._isExecutionSettingEnabled=t.get("ExecutionExtension").composite}_onCellExecuted(t,e){var i,s,o,n,d,r;if(this._isExecutionSettingEnabled){const{notebook:t,cell:h}=e;if(t!==this._panel.content)return;if(h instanceof b.CodeCell){const t=a(h.model,"execution",this._jupyterVersion);if(t&&m.JSONExt.isObject(t)){const e=t["shell.execute_reply.started"]||t["iopub.execute_input"],o=t["shell.execute_reply"];if((!o||t["iopub.execute_input"])&&o&&e){const t=h.model.outputs.toJSON(),n=this._panel.model,{status:d,cell_output_length:_}=(t=>{let e=0,i="ok";for(const s of t){const t=s.output_type;if("stream"===t){const t=s.text;e+=p(t)}else"error"===t?(i="error",e+=s.evalue.length):e+="execute_result"===t||"display_data"===t?p(s.data):0}return{status:i,cell_output_length:e}})(t),u=null===(s=null===(i=a(n,l.cellMapping,this._jupyterVersion))||void 0===i?void 0:i.find((([t])=>t===h.model.id)))||void 0===s?void 0:s[1];u&&(r={notebook_id:this._notebookId,instance_id:this._instanceId,language_mimetype:a(n,"language_info",this._jupyterVersion).mimetype||"text/plain",cell_id:h.model.id,orig_cell_id:u,t_start:e,t_finish:o,status:d,cell_input:h.model.sharedModel.getSource(),cell_output_model:t,cell_output_length:_},console.log("Posting Code Execution :\n",r),c(r,"exec/code"))}}}else if(h instanceof b.MarkdownCell){const t=null===(n=null===(o=a(this._panel.model,l.cellMapping,this._jupyterVersion))||void 0===o?void 0:o.find((([t])=>t===h.model.id)))||void 0===n?void 0:n[1];t&&(d={notebook_id:this._notebookId,instance_id:this._instanceId,cell_id:h.model.id,orig_cell_id:t,time:(new Date).toISOString(),cell_content:h.model.sharedModel.getSource()},console.log("Posting Markdown Execution :\n",d),c(d,"exec/markdown"))}}}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._notebookId=null,this._instanceId=null,s.Signal.clearData(this))}}class I{constructor(t,e){this._settingRegistry=t,this._jupyterVersion=e}createNew(t){return new x(t,this._settingRegistry,this._jupyterVersion)}}class x{constructor(t,e,i){this._onCellsAltered=t=>{const e=_(t,this._jupyterVersion);if(this._isAlterationSettingEnabled){const t=e.filter((t=>!this._cellIdList.includes(t))),i=this._cellIdList.filter((t=>!e.includes(t)));for(const e of t)r({notebook_id:this._notebookId,instance_id:this._instanceId,cell_id:e,alteration_type:"ADD",time:(new Date).toISOString()});for(const t of i)r({notebook_id:this._notebookId,instance_id:this._instanceId,cell_id:t,alteration_type:"REMOVE",time:(new Date).toISOString()})}this._cellIdList=e},this._onPanelDisposed=t=>{t.context.model.cells.changed.disconnect(this._onCellsAltered,this)},this._isDisposed=!1,this._notebookId=void 0,this._instanceId=void 0,this._isAlterationSettingEnabled=!1,this._cellIdList=[],this._jupyterVersion=i,e.load(`${o}:settings`).then((t=>{this._updateSettings(t),t.changed.connect(this._updateSettings.bind(this))}),(t=>{console.error(`${o}: Could not load settings, so did not activate: ${t}`)})),t.context.ready.then((()=>{u(t,i)&&(this._notebookId=a(t.context.model,l.notebookId,i),this._instanceId=a(t.context.model,l.instanceId,i),this._cellIdList=_(t.context.model.cells,i),t.context.model.cells.changed.connect(this._onCellsAltered,this),t.disposed.connect(this._onPanelDisposed,this))}))}_updateSettings(t){this._isAlterationSettingEnabled=t.get("AlterationExtension").composite}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._notebookId=null,this._instanceId=null,this._cellIdList=[],s.Signal.clearData(this))}}var S=new Uint8Array(16);function D(){if(!f&&!(f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(S)}const N=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var w=[],O=0;O<256;++O)w.push((O+256).toString(16).substr(1));const A=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(w[t[e+0]]+w[t[e+1]]+w[t[e+2]]+w[t[e+3]]+"-"+w[t[e+4]]+w[t[e+5]]+"-"+w[t[e+6]]+w[t[e+7]]+"-"+w[t[e+8]]+w[t[e+9]]+"-"+w[t[e+10]]+w[t[e+11]]+w[t[e+12]]+w[t[e+13]]+w[t[e+14]]+w[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&N.test(t)}(i))throw TypeError("Stringified UUID is invalid");return i},E=function(t,e,i){var s=(t=t||{}).random||(t.rng||D)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var o=0;o<16;++o)e[i+o]=s[o];return e}return A(s)};class j{constructor(t){this._jupyterVersion=t}createNew(t){return new V(t,this._jupyterVersion)}}class V{constructor(t,e){this._isDisposed=!1,t.context.ready.then((()=>{const i=t.context.model;a(i,l.notebookId,e)&&(a(i,l.instanceId,e)||h(i,l.instanceId,E(),e))}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,s.Signal.clearData(this))}}class M{constructor(t){this._jupyterVersion=t}createNew(t){return new R(t,this._jupyterVersion)}}class R{constructor(t,e){this._onPanelDisposed=t=>{t.context.model.cells.changed.disconnect(this._onCellsAltered,this)},this._hasCellListChanged=(t,e)=>{if(t.length!==e.length)return!0;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!0;return!1},this._updateCellMapping=t=>{var e,i;const s=a(null===(e=this._panel)||void 0===e?void 0:e.model,l.cellMapping,this._jupyterVersion);if(!s)return;const o=[];for(const[e,i]of t.entries()){const t=s.find((([t,e])=>t===i));if(t)o.push(t);else if(e>0){const t=o[e-1];o.push([i,t[1]])}else{const t=s[0];o.push([i,t[1]])}}h(null===(i=this._panel)||void 0===i?void 0:i.model,l.cellMapping,o,this._jupyterVersion)},this._onCellsAltered=t=>{var e;const i=_(t,this._jupyterVersion);(null===(e=this._panel)||void 0===e?void 0:e.context.isReady)&&this._hasCellListChanged(i,this._cellIdList)&&this._updateCellMapping(i),this._cellIdList=i},this._isDisposed=!1,this._cellIdList=[],this._panel=t,this._jupyterVersion=e,t.context.ready.then((()=>{t&&!t.isDisposed&&a(t.context.model,l.notebookId,e)&&a(t.context.model,l.cellMapping,e)&&(this._cellIdList=_(t.context.model.cells,this._jupyterVersion),t.context.model.cells.changed.connect(this._onCellsAltered,this),t.disposed.connect(this._onPanelDisposed,this))}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._panel=null,this._cellIdList=[],s.Signal.clearData(this))}}var $=i(3680);const F={id:`${o}:plugin`,autoStart:!0,requires:[$.ISettingRegistry],activate:(t,e)=>{console.log(`JupyterLab extension ${o} is activated!`);const i="3.1.0",s=t.version.match(/[0-9]+/g);if(s&&((t,e)=>{const i=t.split(/[^0-9]+/).map(Number),s=e.split(/[^0-9]+/).map(Number);for(let t=0;t<Math.min(i.length,s.length);t++){const e=i[t],o=s[t];if(e!==o)return e-o}const o=t.replace(/[0-9]+/g,""),n=e.replace(/[0-9]+/g,"");return o.localeCompare(n)})(t.version,i)>=0){e.load(`${o}:settings`).catch((t=>{console.error(`${o}: Could not load settings, error: ${t}`)}));const i=parseInt(s[0]);t.docRegistry.addWidgetExtension("Notebook",new j(i)),t.docRegistry.addWidgetExtension("Notebook",new M(i));const n=t.shell;t.docRegistry.addWidgetExtension("Notebook",new g(n,e,i)),t.docRegistry.addWidgetExtension("Notebook",new I(e,i)),t.docRegistry.addWidgetExtension("Notebook",new v(e,i))}else console.log(`Use a more recent version of JupyterLab (>=${i})`)}},L=F}}]);