var is=Object.defineProperty;var os=(s,t,n)=>t in s?is(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var se=(s,t,n)=>(os(s,typeof t!="symbol"?t+"":t,n),n);import{k as cs,r as m,j as e,u as He,a as ls,F as ds,b as us,c as ms,d as xs,e as hs,o as gs,f as js,s as ps,g as fs,h as ys,i as bs,l as vs,m as j,n as T,p as G,q as k,A as Ns,t as b,v as ws,w as ks,x as te,S as Ts,M as Ss,C as Es,y as Cs,z as ne,_ as re,B as P,D as I,E as c,G as O,H as L,Q as xe,I as _s,J as Ls,K as Rs,L as he,N as K,O as _,P as Ve,R as oe,T as ge,U as F,V as $,W as je,X as pe,Y as Ps,Z as Os,$ as qe,a0 as A,a1 as Ds,a2 as $s,a3 as ze,a4 as Ms,a5 as Is,a6 as Be,a7 as R,a8 as N,a9 as Q,aa as W,ab as fe,ac as ye,ad as be,ae as E,af as ve,ag as Fs,ah as As,ai as Us,aj as Hs,ak as Vs,al as qs,am as Ne,an as zs,ao as Oe,ap as De,aq as Bs,ar as Ge,as as Gs,at as Ks,au as Qs,av as Ws,aw as Js,ax as Xs,ay as Ys,az as Zs,aA as et,aB as st,aC as tt,aD as nt}from"./vendor-3fad8192.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();class ce{constructor(t,n,r,a,i){this.id=t,this.name=n,this.description=r,this.tasks=a,this.triggers=i}hasTrigger(){return this.triggers.some(t=>!!t.schedule)}getNextFireTime(){const n=this.triggers.filter(r=>!!r.next_fire_time).sort((r,a)=>r.next_fire_time.getTime()-a.next_fire_time.getTime())[0];if(n)return n.next_fire_time}}class rt extends Error{constructor(n,r,a){super(n);se(this,"data");se(this,"status");this.data={data:a,status:r},this.status=r}}const at=`${window.location.protocol}//${window.location.host}/api`,U={}.VITE_API_BASE_URL||at,we=cs.create({prefixUrl:U,credentials:"include",redirect:"follow"}),it=()=>U,D=async(s,t)=>(await we.get(s,t)).json(),Ke=async(s,t)=>{try{return await we.post(s,t).json()}catch(n){const r=n;throw new rt(r.message,r.response.status,await r.response.json())}},ot=()=>{const s=new URL(U);return s.protocol=s.protocol==="http:"?"ws":"wss",s.pathname+="/ws/",s},ae=s=>`${U}/pipelines/${s}/run`,ie=(s,t)=>`${U}/pipelines/${s}/triggers/${t}/run`,ct=async()=>await D("auth/whoami"),lt=async()=>{await Ke("auth/logout")},dt=()=>({queryKey:["pipelines"],queryFn:async()=>{const s=await D("pipelines/");return s.forEach(t=>{t.triggers.forEach(n=>{n.next_fire_time&&(n.next_fire_time=new Date(n.next_fire_time))})}),s.map(t=>new ce(t.id,t.name,t.description,t.tasks,t.triggers))},initialData:[]}),ke=s=>({queryKey:["pipeline",s],queryFn:async()=>{const t=await D(`pipelines/${s}`);return t.triggers.forEach(n=>{n.next_fire_time&&(n.next_fire_time=new Date(n.next_fire_time))}),new ce(t.id,t.name,t.description,t.tasks,t.triggers)},initialData:new ce("","","",[],[]),enabled:!!s}),ut=s=>({queryKey:["pipeline-input",s],queryFn:async()=>await D(`pipelines/${s}/input-schema`)}),Te=(s,t)=>({queryKey:["runs",s,t],queryFn:async()=>{const r=await D("runs/",{searchParams:{pipeline_id:s??"",trigger_id:t??""}});return r.forEach(a=>{a.start_time=new Date(a.start_time)}),r},initialData:[]}),$e=(s,t,n)=>({queryKey:["runs",s,t,n],queryFn:async()=>{const r=await D(`runs/${n}`);return r.start_time=new Date(r.start_time),r},enabled:!!(s&&t&&n)}),mt=s=>({queryKey:["logs",s],queryFn:async()=>{const t=await we.get(`runs/${s}/logs`).text();return t?t.split(`
`).map((n,r)=>{const a=JSON.parse(n);return a.id=r,a.timestamp=new Date(a.timestamp),a}):[]},enabled:!!s,initialData:[]}),xt=(s,t)=>({queryKey:["getRunData",{runId:s,taskId:t}],queryFn:async()=>await D(`runs/${s}/data/${t}`)}),Qe=(s,t)=>({async mutationFn(n){return await Ke("runs/",{json:{pipeline_id:s,trigger_id:t,params:n}})}}),We=m.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),ht=(s,t)=>{switch(t.type){case"LOGIN":return{...s,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...s,isAuthenticated:!1,user:null};case"POPULATE":return{...s,user:t.payload?{...s.user,...t.payload}:null};case"STOP_LOADING":return{...s,isLoading:!1};default:throw new Error("Unknown action type")}},gt=({children:s})=>{const[t,n]=m.useReducer(ht,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await lt(),n({type:"LOGOUT"})},user:null});return m.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:a,user:i}=await ct();(a&&i||!a)&&n({type:"LOGIN",payload:{user:i,isAuthenticationEnabled:a}})}catch(a){console.error(a)}finally{n({type:"STOP_LOADING"})}})()},[]),e.jsx(We.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":s})},Se=()=>m.useContext(We),jt=s=>`translate${s==="bottom"||s==="top"?"Y":"X"}(${s==="bottom"||s==="right"?"-":"+"}10%)`;function pt({initialOpen:s=!1,placement:t="bottom",modal:n,open:r,onOpenChange:a}={}){const[i,o]=m.useState(s),[u,h]=m.useState(),[g,d]=m.useState(),l=r??i,f=a??o,y=xs({placement:t,open:l,onOpenChange:f,whileElementsMounted:hs,middleware:[gs(5),js({fallbackAxisSideDirection:"end"}),ps({padding:5})]}),v=y.context,w=fs(v,{enabled:r==null}),x=ys(v),p=bs(v),S=vs([w,x,p]);return m.useMemo(()=>({open:l,setOpen:f,...S,...y,modal:n,labelId:u,descriptionId:g,setLabelId:h,setDescriptionId:d}),[l,f,S,y,n,u,g])}const Je=m.createContext(null),J=()=>{const s=m.useContext(Je);if(s==null)throw new Error("Popover components must be wrapped in <Popover />");return s};function ft({children:s,modal:t=!0,...n}){const r=pt({modal:t,...n});return e.jsx(Je.Provider,{value:r,children:s})}const yt=m.forwardRef(function({children:t,asChild:n=!1,...r},a){const i=J(),o=t.ref,u=He([i.refs.setReference,a,o]);return n&&m.isValidElement(t)?m.cloneElement(t,i.getReferenceProps({ref:u,...r,...t.props,"data-state":i.open?"open":"closed"})):e.jsx("button",{ref:u,type:"button","data-state":i.open?"open":"closed",...i.getReferenceProps(r),children:t})}),bt=m.forwardRef(function(t,n){const{context:r,...a}=J(),i=He([a.refs.setFloating,n]),{isMounted:o,styles:u}=ls(r,{initial:({side:h})=>({opacity:0,transform:jt(h)})});return e.jsx(ds,{children:o&&e.jsx(us,{context:r,modal:a.modal,children:e.jsx("div",{ref:i,style:{position:a.strategy,top:a.y??0,left:a.x??0,width:"max-content",...t.style,...u},"aria-labelledby":a.labelId,"aria-describedby":a.descriptionId,...a.getFloatingProps(t),children:t.children})})})});m.forwardRef(function({children:t,...n},r){const{setDescriptionId:a}=J(),i=ms();return m.useLayoutEffect(()=>(a(i),()=>a(void 0)),[i,a]),e.jsx("p",{...n,ref:r,id:i,children:t})});m.forwardRef(function(t,n){const{setOpen:r}=J();return e.jsx("button",{type:"button",ref:n,...t,onClick:a=>{var i;(i=t.onClick)==null||i.call(t,a),r(!1)}})});const vt=()=>{const{logout:s,user:t}=Se();return t?e.jsxs(j,{className:"gap-4 mt-8",children:[e.jsxs("div",{children:[e.jsx(T,{children:t.name}),e.jsx(G,{children:t.email})]}),e.jsx(k,{size:"xs",variant:"secondary",color:"rose",icon:Ns,onClick:async()=>await s()})]}):e.jsx("div",{children:"Not authenticated"})},Xe=0,le=1,Me=2,Nt={[Xe]:"light",[le]:"dark"},H="plomberyTheme",wt=()=>{const s=localStorage[H]==="dark"?le:H in localStorage?Xe:Me,[t,n]=m.useState(s);return e.jsx(ws,{onIndexChange:r=>{let a=!1;return r===Me?(localStorage.removeItem(H),a=window.matchMedia("(prefers-color-scheme: dark)").matches):(a=r===le,localStorage[H]=Nt[r]),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),n(r)},index:t,children:e.jsxs(ks,{variant:"solid",children:[e.jsx(te,{icon:Ts,children:"Light"}),e.jsx(te,{icon:Ss,children:"Dark"}),e.jsx(te,{icon:Es,children:"System"})]})})},kt=()=>{const{user:s,isAuthenticationEnabled:t}=Se();let n=e.jsx(Cs,{});if(t&&s){const r=s.name.split(" ");n=r.length>1?`${r.at(0)[0]}${r.at(-1)[0]}`:r[0]}return e.jsxs(ft,{placement:"bottom-start",children:[e.jsx(yt,{children:e.jsx("div",{className:"flex justify-center items-center font-medium dark:bg-dark-tremor-background dark:ring-dark-tremor-ring ring-1 ring-slate-300 text-indigo-500 rounded-full hover:ring-2 hover:ring-indigo-400 dark:hover:ring-indigo-700 transition-shadow",style:{width:34,height:34},children:n})}),e.jsx(bt,{children:e.jsxs(b,{className:"shadow-xl z-20",children:[e.jsx(wt,{}),t&&e.jsx(vt,{})]})})]})},X=({children:s,header:t})=>e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-950 p-6 sm:p-10 min-h-screen",children:[e.jsxs(j,{className:"items-start gap-8",children:[t&&e.jsx("div",{className:"flex-grow max-w-full",children:t}),e.jsx(kt,{})]}),e.jsx("main",{children:s})]}),Y=({children:s,footer:t,isOpen:n,subtitle:r,title:a,onClose:i})=>e.jsx(ne,{show:n,as:m.Fragment,children:e.jsxs(re,{onClose:i,className:"relative z-50",children:[e.jsx(ne.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/30 dark:bg-black/50 backdrop-blur-sm","aria-hidden":"true"})}),e.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-12",children:e.jsx(ne.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-1/3",enterTo:"opacity-100 translate-y-0",leave:"ease-in duration-300",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 -translate-y-1/3",children:e.jsx(re.Panel,{className:"max-w-full",children:e.jsxs(b,{children:[a&&e.jsx(re.Title,{children:e.jsx(T,{children:a})}),r&&e.jsx(G,{children:r}),e.jsx("div",{className:(a||r)&&"mt-6",children:s}),t&&e.jsx(j,{className:"justify-end space-x-6 mt-6",children:t})]})})})})]})}),Tt=({label:s,...t})=>{const n=m.createRef();return e.jsxs("div",{children:[e.jsx("input",{type:"range",onInput:r=>n.current&&(n.current.value=r.target.value),className:"w-full cursor-ew-resize appearance-none accent-indigo-500 h-2 bg-tremor-background border border-tremor-border dark:border-dark-tremor-border dark:bg-dark-tremor-background rounded",...t}),e.jsxs(P,{numItems:3,className:"items-baseline",children:[e.jsx(I,{children:e.jsxs("div",{className:"ml-1 inline-block",children:[e.jsx("div",{className:"border-r border-slate-300 dark:border-slate-600 h-2 mx-auto",style:{width:1}}),e.jsx(c,{children:t.min})]})}),e.jsx(j,{className:"justify-center",children:e.jsx(c,{children:e.jsx(O,{children:e.jsx("output",{ref:n,className:"px-2 py-1 rounded bg-tremor-background-subtle dark:bg-dark-tremor-background-subtle block truncate text-center",children:t.defaultValue})})})}),e.jsx(j,{className:"justify-end",children:e.jsxs("div",{className:"mr-1",children:[e.jsx("div",{className:"border-r border-slate-300 dark:border-slate-600 h-2 mx-auto",style:{width:1}}),e.jsx(c,{children:t.max})]})})]})]})},St={checkbox:s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{id:s.name,name:s.name,type:"checkbox",defaultChecked:s.defaultValue==="true",className:"w-4 h-4 accent-indigo-500 bg-tremor-background rounded dark:bg-dark-tremor-background cursor-pointer"}),e.jsx("label",{htmlFor:s.name,className:"pl-2 cursor-pointer",children:e.jsx(c,{children:s.label})})]}),number:s=>{const t=s.value.minimum??s.value.exclusiveMinimum,n=s.value.maximum??s.value.exclusiveMaximum;return e.jsx(_s,{name:s.name,min:t,max:n,defaultValue:s.defaultValue,required:s.required})},range:s=>{const t=s.value.minimum??s.value.exclusiveMinimum??0,n=s.value.maximum??s.value.exclusiveMaximum??0,r=s.type==="number"?(n-t)/10:1;return e.jsx(Tt,{name:s.name,label:s.label,min:t,max:n,step:r,defaultValue:s.defaultValue,required:s.required})},select:s=>{const[t,n]=m.useState(s.defaultValue||"");return e.jsxs("div",{children:[e.jsx(Ls,{defaultValue:s.defaultValue,onValueChange:n,value:t,children:s.value.enum.map(r=>e.jsx(Rs,{value:r.toString(),children:r==null?void 0:r.toString()},r==null?void 0:r.toString()))}),e.jsx("input",{type:"hidden",name:s.name,value:t})]})},text:s=>e.jsx(he,{name:s.name,placeholder:s.label,defaultValue:s.defaultValue})},Et=s=>{let t="text";if(s.type==="number"||s.type==="integer"){const n=s.value.minimum??s.value.exclusiveMinimum,r=s.value.maximum??s.value.exclusiveMaximum;n!==void 0&&r!==void 0?t="range":t="number"}else s.type==="enum"?t="select":s.type==="boolean"&&(t="checkbox");return St[t](s)},Ct=({errors:s={},schema:t})=>{const n=m.useCallback(i=>{const o=t.definitions||t.$defs;if(!o)return;const u=i.split("/").pop();return o[u]},[t]),r=t.properties;if(!r)return e.jsx(c,{className:"mt-4",children:"This pipeline has no input parameters, but you can still run it!"});const a=Object.entries(r).map(([i,o])=>{var y,v,w;if(typeof o=="boolean")return;let u=o,h;const g=u.title||i;if(o.allOf){const x=o.allOf[0];if(h=(y=o.default)==null?void 0:y.toString(),x.$ref){const p=n(x.$ref);p&&(u=p)}}else if(o.$ref){const x=n(o.$ref);x&&(u=x)}else h=(v=u.default)==null?void 0:v.toString();const d=(u.enum?"enum":Array.isArray(u.type)?u.type[0]:u.type)||"string",l=((w=t.required)==null?void 0:w.includes(i))??!1,f=Et({defaultValue:h,label:g,name:i,required:l,type:d,value:u});return e.jsxs("div",{children:[e.jsxs(j,{className:"justify-between",children:[e.jsxs(c,{className:"mb-2",children:[g,l&&" *"]}),u.description&&e.jsx(L,{icon:xe,tooltip:u.description,color:"neutral"})]}),f,s[i]&&e.jsx(c,{color:"rose",className:"mt-1",children:s[i]})]},i)});return e.jsx(j,{className:"gap-4 flex-col items-stretch",children:a})},Ee=({pipeline:s})=>{var h;const[t,n]=m.useState(!1),r=K(),a=_({...ut(s.id),enabled:t}),i=Ve(Qe(s.id)),o=i.isError&&i.error.status===422?Object.fromEntries(i.error.data.data.detail.map(g=>[g.loc.join("."),g.msg])):void 0,u=(h=i.error)==null?void 0:h.message;return e.jsxs(e.Fragment,{children:[e.jsx(k,{color:"indigo",variant:"secondary",size:"xs",icon:oe,onClick:()=>n(!0),children:"Run"}),e.jsx(Y,{isOpen:t,title:`Run ${s.name} manually`,onClose:()=>n(!1),children:e.jsxs("form",{onSubmit:async g=>{g.preventDefault();const d=Object.fromEntries(new FormData(g.target).entries());try{const l=await i.mutateAsync(d);r(`/pipelines/${l.pipeline_id}/triggers/${l.trigger_id}/runs/${l.id}`),n(!1)}catch(l){console.error(l)}},children:[a.isLoading?"Loading...":a.isError?"Error":e.jsxs("div",{style:{width:350},children:[e.jsx(Ct,{schema:a.data,errors:o}),u&&e.jsx(c,{className:"mt-2",color:"rose",children:u})]}),e.jsxs(j,{className:"justify-end space-x-6 mt-6",children:[e.jsx(k,{type:"button",variant:"secondary",color:"indigo",onClick:()=>{n(!1)},disabled:i.isLoading,children:"Close"}),e.jsx(k,{color:"indigo",type:"submit",icon:oe,disabled:i.isLoading,children:"Run"})]})]})})]})},_t=()=>{const s=_(dt());if(s.isLoading)return e.jsx("div",{children:"Loading..."});if(s.isError)return e.jsx("div",{children:"An error has occurred"});const t=s.data;return e.jsxs(b,{children:[e.jsx(T,{children:"Pipelines"}),e.jsxs(ge,{children:[t.map(n=>{var r;return e.jsxs(F,{className:"gap-x-1",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(c,{className:"truncate",children:e.jsx(O,{children:e.jsx($,{to:`/pipelines/${n.id}`,children:n.name})})}),n.description&&e.jsx(c,{className:"truncate",children:n.description})]}),n.hasTrigger()&&e.jsxs("div",{className:"min-w-0",title:(r=n.getNextFireTime())==null?void 0:r.toString(),children:[e.jsx(c,{className:"truncate",children:"Next fire time"}),e.jsx(c,{className:"truncate",children:e.jsx(O,{children:je(n.getNextFireTime(),{addSuffix:!0,includeSeconds:!0})})})]}),e.jsx(Ee,{pipeline:n})]},n.id)}),t.length===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{className:"text-center italic",children:"There are no pipelines, you can't do much."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/pipelines/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",children:["How to create pipelines",e.jsx(L,{icon:pe,size:"sm",className:"p-0",color:"indigo"})]})})]})]})]})},Ce=s=>{const t=u=>{const{type:h}=JSON.parse(u.data);return h===s},n=Ps(ot().toString(),{share:!0,filter:s?t:void 0}),r=n.lastJsonMessage,a=(u,h)=>{n.sendJsonMessage({type:u,data:h})},i=u=>{a("subscribe",u)},o=u=>{a("unsubscribe",u)};return m.useEffect(()=>{if(s)return i(s),()=>{o(s)}},[]),{lastMessage:r,send:a,subscribe:i,unsubscribe:o}},Lt=()=>e.jsx("div",{className:"tremor-Badge-icon -ml-1 mr-1.5 h-4 w-4 animate-spin",children:e.jsx(Os,{})}),V={pending:"slate",completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",warning:"amber"},de={pending:Ds,completed:$s,failed:ze,cancelled:Ms,running:Lt,warning:Is},ue=["cyan","violet","pink","emerald","orange","stone","fuchsia"],Ye=s=>Object.fromEntries(s.map((t,n)=>[t.id,`bg-${ue[n%ue.length]}-500`])),q=(s,t=!1)=>{if(t){const n=qe(s,s.getTimezoneOffset());return A(n,"d MMM yyyy HH:mm:ss")+" (UTC)"}else return A(s,"d MMM yyyy HH:mm:ss (XXX)")},z=(s,t=!1)=>{if(t){const n=qe(s,s.getTimezoneOffset());return A(n,"HH:mm:ss.SSS")+" (UTC)"}else return A(s,"HH:mm:ss.SSS")},Ie=s=>A(s,"d MMM yyyy"),Rt=new Intl.NumberFormat,Pt=s=>Rt.format(s),Ze=({status:s})=>e.jsx(Be,{color:V[s],icon:de[s],children:s}),es=({startTime:s})=>{const[t,n]=m.useState(Date.now()-s.getTime());return m.useEffect(()=>{const r=setInterval(()=>{n(Date.now()-s.getTime())},500);return()=>{clearInterval(r)}}),e.jsx("span",{children:(t/1e3).toFixed(2)})},_e=({query:s})=>s.isError?e.jsxs(e.Fragment,{children:[e.jsxs(j,{justifyContent:"start",children:[e.jsx(L,{icon:ze,color:"rose",className:"pl-0"}),e.jsx(T,{children:"Error fetching data"})]}),e.jsx(c,{children:s.error.message}),e.jsx(j,{justifyContent:"center",className:"mt-4",children:e.jsx(k,{color:"rose",variant:"light",size:"xs",onClick:()=>s.refetch(),children:"Retry"})})]}):null,Z="animate-pulse rounded",ee="bg-slate-200 dark:bg-slate-700",Ot=({className:s})=>e.jsx("div",{className:Q("h-10",Z,ee,s)}),Dt=({className:s})=>e.jsx("div",{className:Q("h-28",Z,ee,s)}),me=({className:s})=>e.jsx(c,{className:Q(Z,ee,s),children:" "}),ss=({className:s})=>e.jsx(W,{className:Q("w-24",Z,ee,s),children:" "}),$t=({columns:s=6,rows:t=10})=>new Array(t).fill(1).map((n,r)=>e.jsx(R,{className:"animate-pulse",children:new Array(s).fill(1).map((a,i)=>e.jsx(N,{children:e.jsx(me,{})},i))},r)),Le=({pipelineId:s,query:t,triggerId:n})=>{const[r,a]=m.useState(t.data||[]),i=fe(),o=K(),{lastMessage:u}=Ce("run-update"),h=m.useCallback(d=>{const{data:l,type:f}=d;if(l.run.start_time=new Date(l.run.start_time),l.run.trigger_id=l.trigger,l.run.status==="running")a([l.run,...r]);else{let y=[...r];const v=y.findIndex(w=>w.id===l.run.id);v>=0?y[v]=l.run:y=[l.run,...y],a(y),i.invalidateQueries({queryKey:["runs",s,n]})}},[s,i,r,n]);m.useEffect(()=>{u&&h(u)},[u]),m.useEffect(()=>{var d;(d=t.data)!=null&&d.length&&a(t.data)},[t.data]);const g=4+ +!!s+ +!!n;return e.jsxs(b,{children:[e.jsx(T,{children:"Runs"}),e.jsxs(ye,{className:"overflow-auto max-h-[50vh]",children:[e.jsx(be,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(R,{children:[e.jsx(E,{className:"text-right",children:"#"}),e.jsx(E,{children:"Status"}),!s&&e.jsx(E,{children:"Pipeline"}),!n&&e.jsx(E,{children:"Trigger"}),e.jsx(E,{children:"Started at"}),e.jsx(E,{className:"text-right",children:"Duration"})]})}),e.jsxs(ve,{children:[r.map(d=>e.jsxs(R,{className:"cursor-pointer hover:bg-slate-50 dark:hover:bg-dark-tremor-background-subtle transition-colors",onClick:()=>o(`/pipelines/${d.pipeline_id}/triggers/${d.trigger_id}/runs/${d.id}`),children:[e.jsx(N,{className:"text-right",children:d.id}),e.jsx(N,{children:e.jsx(Ze,{status:d.status})}),!s&&e.jsx(N,{children:e.jsx($,{to:`/pipelines/${d.pipeline_id}`,className:"link--arrow",title:"View pipeline details",onClick:l=>l.stopPropagation(),children:d.pipeline_id})}),!n&&e.jsx(N,{children:e.jsx($,{to:`/pipelines/${d.pipeline_id}/triggers/${d.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:l=>l.stopPropagation(),children:d.trigger_id})}),e.jsx(N,{title:q(d.start_time,!0),children:e.jsx(c,{children:Fs(new Date,d.start_time)<=1?je(d.start_time,{addSuffix:!0,includeSeconds:!0}):q(d.start_time)})}),e.jsxs(N,{className:"text-right",children:[d.status!=="running"?(d.duration/1e3).toFixed(2):e.jsx(es,{startTime:d.start_time})," ","s"]})]},d.id)),(t.isFetching||t.isLoading)&&e.jsx($t,{columns:g}),t.isError&&e.jsx(R,{children:e.jsx(N,{colSpan:g,children:e.jsx(_e,{query:t})})})]})]})]})},Mt=()=>{const s=_(Te());return e.jsx(X,{header:e.jsx(e.Fragment,{children:e.jsx(T,{children:"Plombery"})}),children:e.jsxs(P,{numItemsMd:2,className:"gap-6 mt-6",children:[e.jsx(I,{children:e.jsx(_t,{})}),e.jsx(I,{children:e.jsx(Le,{query:s})})]})})},It=()=>e.jsx("div",{className:"bg-slate-100 dark:bg-slate-950 h-screen flex justify-center items-center",children:e.jsxs(b,{className:"w-auto",children:[e.jsx("div",{className:"w-12 rounded-full mx-auto mb-4",children:e.jsx("img",{src:"/mario-pipe-flower.png",alt:"Plombery logo"})}),e.jsx(T,{className:"mb-6",children:"Welcome to Plombery"}),e.jsx(k,{onClick:()=>{location.href=`${it()}/auth/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),ts=({className:s,content:t})=>{const[n,r]=m.useState(!1),a=m.useRef();return e.jsx(k,{variant:"light",color:"indigo",size:"sm",icon:n?As:Us,tooltip:"Click to copy",className:s,onClick:()=>{navigator.clipboard.writeText(t),r(!0),a.current=setTimeout(()=>r(!1),3e3)}})},M=()=>e.jsx(c,{children:"/"}),Re=({pipeline:s,trigger:t,run:n,className:r})=>{if(n&&!t)throw new Error;return e.jsxs(j,{className:`gap-x-2 justify-start flex-wrap ${r||""}`,children:[e.jsx(c,{children:e.jsx($,{to:"/",children:"Pipelines"})}),e.jsx(M,{}),e.jsx(c,{children:t?e.jsx($,{to:`/pipelines/${s.id}`,children:s.name}):s.name}),t&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(c,{children:"Triggers"}),e.jsx(M,{}),e.jsx(c,{children:n?e.jsx($,{to:`/pipelines/${s.id}/triggers/${t.id}`,children:t.name}):t.name})]}),n&&t&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(c,{children:"Runs"}),e.jsx(M,{}),e.jsxs(c,{children:["#",n.id]})]})]})},Fe=s=>(s/1e3).toFixed(1)+" s",Ft=()=>e.jsxs(b,{children:[e.jsx(c,{children:"Duration (AVG)"}),e.jsx(ss,{}),e.jsx(Dt,{className:"mt-6"})]}),ns=({query:s})=>{if(s.isFetching||s.isLoading)return e.jsx(Ft,{});if(s.isError)return e.jsx(b,{children:e.jsx(_e,{query:s})});const t=s.data.filter(r=>r.status==="completed").reverse(),n=t.reduce((r,a)=>r+a.duration,0)/t.length||0;return e.jsxs(b,{children:[e.jsx(j,{className:"items-start",children:e.jsx(c,{children:"Duration (AVG)"})}),e.jsx(j,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsx(W,{children:Fe(n)})}),e.jsx(Hs,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:Fe,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},At=({subject:s})=>e.jsxs(b,{children:[e.jsx(c,{children:"Successful runs"}),e.jsx(ss,{}),e.jsxs(c,{className:"mt-4",children:[s," health"]}),e.jsx(Ot,{}),e.jsxs(j,{className:"mt-2",children:[e.jsx(me,{className:"w-20"}),e.jsx(me,{className:"w-20"})]})]}),rs=({query:s,subject:t})=>{var u,h;if(s.isLoading||s.isFetching)return e.jsx(At,{subject:t});if(s.isError)return e.jsx(b,{children:e.jsx(_e,{query:s})});const n=[...s.data].reverse(),a=n.filter(g=>g.status==="completed").length/n.length*100||0,i=(u=n[0])==null?void 0:u.start_time,o=(h=n[n.length-1])==null?void 0:h.start_time;return e.jsxs(b,{children:[e.jsx(j,{className:"items-start",children:e.jsx(c,{children:"Successful runs"})}),e.jsx(j,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsxs(W,{children:[a.toFixed(1)," ",e.jsx("span",{className:"text-lg",children:"%"})]})}),n.length?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mt-4",children:e.jsxs(c,{children:[t," health"]})}),e.jsx(Vs,{className:"mt-2",data:n.map(g=>({key:g.id,color:V[g.status],tooltip:`#${g.id} ${g.status}`}))})]}):e.jsx(c,{className:"text-center mt-8",children:e.jsxs(qs,{children:["This ",t.toLowerCase()," has no runs yet"]})}),e.jsxs(j,{className:"mt-2",children:[e.jsx(c,{children:i&&i.toDateString()}),e.jsx(c,{children:o&&o.toDateString()})]})]})},Ut=({pipeline:s})=>{const t=K();return e.jsxs(b,{children:[e.jsx(T,{children:"Triggers"}),e.jsxs(ye,{children:[e.jsx(be,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(R,{children:[e.jsx(E,{children:"Name"}),e.jsx(E,{children:"Interval"}),e.jsx(E,{children:"Next Fire Time"})]})}),e.jsxs(ve,{children:[s.triggers.map(n=>e.jsxs(R,{className:"cursor-pointer hover:bg-slate-50 dark:hover:bg-dark-tremor-background-subtle transition-colors",onClick:()=>t(`/pipelines/${s.id}/triggers/${n.id}`),children:[e.jsx(N,{children:n.name}),e.jsx(N,{children:e.jsx(c,{children:n.schedule})}),e.jsx(N,{children:je(s.getNextFireTime(),{includeSeconds:!0,addSuffix:!0})})]},n.id)),s.triggers.length===0&&e.jsx(R,{children:e.jsxs(N,{colSpan:3,children:[e.jsx(c,{className:"text-center italic",children:"This pipeline has no triggers, can be run only manually."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/triggers/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",children:["How to create triggers",e.jsx(L,{icon:pe,size:"sm",className:"p-0",color:"indigo"})]})})]})})]})]})]})},Ht=()=>{const t=Ne().pipelineId,n=_(ke(t)),r=_(Te(t)),a=()=>e.jsx(ts,{content:ae(t),className:"ml-2.5"});if(n.isLoading)return e.jsx("div",{children:"Loading..."});if(n.isError)return e.jsx("div",{children:"An error has occurred"});const i=n.data;return e.jsxs(X,{header:e.jsxs("div",{children:[e.jsxs(j,{className:"items-start",children:[e.jsxs(j,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[e.jsxs(T,{className:"truncate max-w-full",children:["Pipeline ",i.name]}),i.description&&e.jsxs(c,{className:"truncate max-w-full",children:[e.jsx("span",{className:"hidden md:inline mx-2",children:"·"}),i.description]})]}),e.jsx(Ee,{pipeline:i})]}),e.jsx(Re,{pipeline:i,className:"mt-4"})]}),children:[e.jsxs(P,{numItemsMd:2,numItemsLg:3,className:"gap-6 mt-6",children:[e.jsxs(b,{className:"flex flex-col h-full",children:[e.jsx(T,{children:"Tasks"}),e.jsxs(ge,{children:[i.tasks.map(o=>e.jsx(F,{children:e.jsxs("div",{children:[e.jsx(c,{children:e.jsx(O,{children:o.name})}),o.description&&e.jsx(c,{className:"truncate",children:o.description})]})},o.id)),i.tasks.length===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{className:"text-center italic",children:"This pipeline has no tasks so it can't be run."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/tasks/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",children:["How to create tasks",e.jsx(L,{icon:pe,size:"sm",className:"p-0",color:"indigo"})]})})]})]}),e.jsx("div",{style:{flexGrow:1}}),e.jsxs(j,{className:"gap-8",children:[e.jsxs(j,{className:"justify-start w-auto flex-shrink-0",children:[e.jsx(c,{children:"Run URL"}),e.jsx(L,{size:"sm",color:"slate",icon:xe,tooltip:"URL to run the pipeline programmatically via an HTTP POST request"})]}),e.jsx(he,{title:ae(t),value:ae(t),readOnly:!0,icon:a,className:"flex-grow"})]})]}),e.jsx(rs,{subject:"Pipeline",query:r}),e.jsx(ns,{query:r})]}),e.jsxs(P,{numItems:1,numItemsSm:1,numItemsMd:1,numItemsLg:2,className:"gap-6 mt-6",children:[e.jsx(I,{children:e.jsx(Ut,{pipeline:i})}),e.jsx(I,{children:e.jsx(Le,{query:r,pipelineId:t})})]})]})},Vt=({trigger:s})=>{const[t,n]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(k,{color:"indigo",variant:"light",size:"sm",icon:zs,onClick:()=>n(!0),children:"Show params"}),e.jsx(Y,{isOpen:t,title:"Trigger params",subtitle:s.name,footer:e.jsx(k,{variant:"primary",color:"indigo",onClick:()=>{n(!1)},children:"Close"}),onClose:()=>n(!1),children:e.jsx("pre",{className:"p-3 bg-slate-100 dark:bg-dark-tremor-background-subtle dark:text-dark-tremor-content-emphasis rounded-md",children:JSON.stringify(s.params,null,2)})})]})},B={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},qt=()=>{const s=K(),t=Ne(),n=t.pipelineId,r=t.triggerId,a=_(ke(n)),i=_({...Te(n,r),enabled:!!r}),o=Ve({...Qe(n,r),onSuccess(f){s(`/pipelines/${f.pipeline_id}/triggers/${f.trigger_id}/runs/${f.id}`)}}),u=()=>e.jsx(ts,{content:ie(n,r),className:"ml-2.5"});if(a.isLoading)return e.jsx("div",{children:"Loading..."});if(a.isError)return e.jsx("div",{children:"An error has occurred"});const h=a.data,g=r===B.id,d=g?B:h.triggers.find(f=>f.id===r);if(!d)return e.jsx("div",{children:"Trigger not found"});const l=g?e.jsx(Ee,{pipeline:h}):e.jsx(k,{size:"xs",color:"indigo",variant:"secondary",icon:oe,onClick:()=>{o.mutateAsync()},children:"Run"});return e.jsxs(X,{header:e.jsxs("div",{children:[e.jsxs(j,{className:"items-start",children:[e.jsxs(j,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[e.jsxs(T,{className:"truncate max-w-full",children:["Trigger ",d.name]}),d.description&&e.jsxs(c,{className:"truncate max-w-full",children:[e.jsx("span",{className:"hidden md:inline mx-2",children:"·"}),d.description]})]}),l]}),e.jsx(Re,{pipeline:h,trigger:d,className:"mt-4"})]}),children:[e.jsxs(P,{numItemsMd:2,numItemsLg:3,className:"gap-6 mt-6",children:[e.jsxs(b,{className:"flex flex-col h-full",children:[e.jsx(T,{children:d.name}),e.jsx(G,{children:d.description}),e.jsx("div",{style:{flexGrow:1}}),e.jsxs(F,{children:[e.jsx(c,{children:"Schedule"}),e.jsx(c,{children:e.jsx(O,{children:d.schedule})})]}),e.jsxs(F,{children:[e.jsx(c,{children:"Params"}),d.params?e.jsx(Vt,{trigger:d}):e.jsx(c,{children:e.jsx("em",{children:"No params"})})]}),e.jsxs(j,{className:"gap-8",children:[e.jsxs(j,{className:"justify-start w-auto flex-shrink-0",children:[e.jsx(c,{children:"Run URL"}),e.jsx(L,{size:"sm",color:"slate",icon:xe,tooltip:"URL to run the pipeline programmatically via an HTTP POST request"})]}),e.jsx(he,{title:ie(n,r),value:ie(n,r),readOnly:!0,icon:u,className:"flex-grow"})]})]}),e.jsx(rs,{subject:"Trigger",query:i}),e.jsx(ns,{query:i})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Le,{query:i,pipelineId:n,triggerId:r})})]})},zt=({logEntry:s})=>{const[t,n]=m.useState(!1);return e.jsxs(j,{className:"mt-1",children:[e.jsx(k,{color:"rose",variant:"secondary",size:"xs",onClick:()=>n(!0),children:"Traceback info"}),e.jsx(Y,{isOpen:t,title:"Traceback info",footer:e.jsx(k,{variant:"primary",color:"indigo",onClick:()=>{n(!1)},children:"Close"}),onClose:()=>n(!1),children:e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-tremor-background-subtle dark:bg-dark-tremor-background-subtle rounded-md whitespace-pre font-mono",children:s.exc_info})})})]})},Bt=30,Ae={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},Gt=({pipeline:s,run:t})=>{const[n,r]=m.useState({levels:[],tasks:[]}),[a,i]=m.useState(!0),{lastMessage:o}=Ce(`logs.${t.id}`),u=fe(),h=m.createRef(),g=_(mt(t.id)),d=m.useCallback(x=>{const{data:p}=x;u.setQueryData(["logs",t.id],(S=[])=>{const C=JSON.parse(p);return C.id=S.length,C.timestamp=new Date(C.timestamp),[...S,C]})},[t.id]),l=m.useCallback(x=>{var Pe;const p=(Pe=h.current)==null?void 0:Pe.parentElement;if(!p)return;const S=x;let C=Math.max(p.scrollTop+p.clientHeight+S.deltaY,0);C=Math.min(C,p.scrollHeight);const as=p.scrollHeight-C<Bt;i(as)},[h]);m.useEffect(()=>{var x,p;return(p=(x=h.current)==null?void 0:x.parentElement)==null||p.addEventListener("wheel",l),()=>{var S,C;(C=(S=h.current)==null?void 0:S.parentElement)==null||C.removeEventListener("wheel",l)}},[h]),m.useEffect(()=>{var x;if(a){const p=(x=h.current)==null?void 0:x.parentElement;p==null||p.scrollTo({top:p.scrollHeight,behavior:"smooth"})}}),m.useEffect(()=>{o&&d(o)},[o]);const f=m.useCallback(x=>{r(p=>({...p,...x}))},[]);if(g.isLoading)return e.jsx("div",{children:"Loading..."});if(g.isError)return e.jsx("div",{children:"Error loading logs"});const y=g.data.filter(x=>(n.levels.length===0||n.levels.includes(x.level))&&(n.tasks.length===0||n.tasks.includes(x.task))),v=Ye(s.tasks),w=["running","pending"].includes(t.status);return e.jsxs(j,{flexDirection:"col",alignItems:"stretch",style:{maxHeight:600},children:[e.jsxs(P,{numItemsMd:3,className:"gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Tasks"}),e.jsx(Oe,{className:"mt-1 z-20",onValueChange:x=>{f({tasks:x})},children:s.tasks.map(x=>e.jsx(De,{value:x.id,children:x.name},x.id))})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Log level"}),e.jsx(Oe,{className:"mt-1 z-20",onValueChange:x=>{f({levels:x})},children:Object.keys(Ae).map(x=>e.jsx(De,{value:x},x))})]}),w&&e.jsxs(j,{justifyContent:"end",className:"order-first md:order-last",children:[e.jsx(L,{icon:Bs,variant:"light",color:a?"indigo":"gray",tooltip:"Automatically scroll to the latest logs. Click to toggle",className:"mr-4",style:{cursor:"pointer"},onClick:()=>{i(!a)}}),e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-indigo-500"})]}),e.jsx(c,{className:"ml-2 opacity-80",children:"Live logs"})]})]}),e.jsxs(ye,{className:"mt-6 flex-grow",ref:h,children:[e.jsx(be,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(R,{children:[e.jsx(E,{children:"Time"}),e.jsx(E,{children:"Level"}),e.jsx(E,{children:"Task"}),e.jsx(E,{children:"Message"})]})}),e.jsx(ve,{children:y.map((x,p)=>{const S=p!==0?x.timestamp.getTime()-y[p-1].timestamp.getTime():-1;return e.jsxs(R,{children:[e.jsx(N,{children:e.jsxs(c,{className:"font-mono text-xs",children:[e.jsx("span",{title:z(x.timestamp,!0),children:z(x.timestamp)}),S>=0&&e.jsxs("span",{className:"text-slate-400 ml-2",children:["+",Pt(S)," ms"]})]})}),e.jsx(N,{children:e.jsx(Be,{size:"xs",color:Ae[x.level],children:x.level})}),e.jsx(N,{children:e.jsxs(j,{children:[e.jsx("div",{className:`h-2 w-2 mr-2 rounded-full ${v[x.task]}`}),x.task]})}),e.jsxs(N,{className:"w-full",children:[e.jsx(c,{children:x.message}),x.exc_info&&e.jsx(zt,{logEntry:x})]})]},x.id)})})]})]})},Kt="modulepreload",Qt=function(s){return"/"+s},Ue={},Wt=function(t,n,r){if(!n||n.length===0)return t();const a=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=Qt(i),i in Ue)return;Ue[i]=!0;const o=i.endsWith(".css"),u=o?'[rel="stylesheet"]':"";if(!!r)for(let d=a.length-1;d>=0;d--){const l=a[d];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${u}`))return;const g=document.createElement("link");if(g.rel=o?"stylesheet":Kt,o||(g.as="script",g.crossOrigin=""),g.href=i,document.head.appendChild(g),o)return new Promise((d,l)=>{g.addEventListener("load",d),g.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},Jt=Ge.lazy(()=>Wt(()=>import("./HandsonTable-483d6715.js"),["assets/HandsonTable-483d6715.js","assets/vendor-3fad8192.js","assets/HandsonTable-3e538464.css"])),Xt=({runId:s,taskId:t,open:n,onClose:r})=>{const a=_({...xt(s,t),enabled:n});return e.jsx(e.Fragment,{children:e.jsxs(Y,{title:t,subtitle:"View data",isOpen:n,footer:e.jsx(k,{variant:"secondary",color:"indigo",onClick:()=>r(),children:"Close"}),onClose:r,children:[!a.isLoading&&!a.isError&&e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Jt,{data:a.data,rowHeaders:!0,colHeaders:Object.keys(a.data[0]),height:"70vh",width:"700px",licenseKey:"non-commercial-and-evaluation"})}),a.isError&&(a.error.response.status===404?e.jsx(c,{children:"The task has no data"}):e.jsxs(c,{color:"rose",children:["Error fetching task data: ",a.error.message]}))]})})},Yt=({pipeline:s,run:t})=>{const[n,r]=m.useState(),a=Ye(s.tasks);return e.jsxs(b,{children:[e.jsx(Xt,{runId:t.id,taskId:n||"",open:!!n,onClose:()=>r(void 0)}),e.jsx(T,{children:"Tasks"}),e.jsx(ge,{children:s.tasks.map((i,o)=>{var u;return e.jsxs(F,{className:"space-x-4",children:[t.tasks_run&&t.tasks_run[o]?e.jsx(L,{variant:"light",icon:de[t.tasks_run[o].status],color:V[t.tasks_run[o].status]}):e.jsx(L,{variant:"light",icon:de.pending,color:V.pending}),e.jsxs("div",{className:"truncate flex-grow",children:[e.jsxs(j,{className:"justify-start",children:[e.jsx("div",{className:`h-2 w-2 mr-2 rounded-full ${a[i.id]}`}),e.jsx(G,{className:"truncate text-base text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:i.name})]}),i.description&&e.jsx(c,{className:"truncate",children:i.description})]}),t.tasks_run&&((u=t.tasks_run[o])==null?void 0:u.has_output)&&e.jsx(k,{variant:"light",color:"indigo",size:"xs",icon:Gs,onClick:()=>r(i.id),children:"Data"})]},i.id)})})]})},Zt=()=>{const{lastMessage:s}=Ce("run-update"),t=fe(),n=Ne(),r=n.pipelineId,a=n.triggerId,i=parseInt(n.runId);m.useEffect(()=>{s&&t.invalidateQueries({queryKey:$e(r,a,i).queryKey})},[s,r]);const o=_(ke(r)),u=_($e(r,a,i));if(o.isLoading)return e.jsx("div",{children:"Loading..."});if(o.isError)return e.jsx("div",{children:"Error"});const h=o.data,d=a===B.id?B:h.triggers.find(w=>w.id===a),l=u.data;if(!l)return e.jsx("div",{children:"Run not found"});if(!d)return e.jsx("div",{children:"Trigger not found"});const f=(l.tasks_run||[]).reduce((w,x)=>w+x.duration,0),y=(l.tasks_run||[]).map(w=>f?w.duration/f*100:0),v=Ks(l.start_time,l.duration);return e.jsxs(X,{header:e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:["Run #",i]}),e.jsx(Re,{pipeline:h,trigger:d,run:l})]}),children:[e.jsxs(P,{numItemsMd:3,className:"gap-6 mt-6",children:[e.jsx(Yt,{pipeline:h,run:l}),e.jsxs(b,{children:[e.jsxs(j,{className:"items-start",children:[e.jsx(c,{children:"Duration"}),e.jsx(Ze,{status:l.status})]}),e.jsx(j,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsxs(W,{children:[l.status!=="running"?(l.duration/1e3).toFixed(2):e.jsx(es,{startTime:l.start_time})," ","s"]})}),e.jsx(Qs,{values:y,colors:ue,showLabels:!1,className:"mt-3"}),e.jsxs(j,{alignItems:"start",className:"mt-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:e.jsx(O,{title:q(l.start_time,!0),children:z(l.start_time)})}),e.jsx(c,{className:"mt-1",children:Ie(l.start_time)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{children:e.jsx(O,{title:q(v,!0),children:z(v)})}),!Ws(l.start_time,v)&&e.jsx(c,{children:Ie(v)})]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(b,{children:e.jsx(Gt,{pipeline:h,run:l})})})]})},en=({children:s})=>{const{isAuthenticated:t,isLoading:n}=Se(),r=Js();return!t&&!n?e.jsx(Xs,{to:"/login",replace:!0,state:{from:r}}):e.jsx(e.Fragment,{children:s})},sn=Object.assign({"./pages/index.tsx":Mt,"./pages/login.tsx":It,"./pages/pipelines/[pipelineId]/index.tsx":Ht,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":qt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":Zt}),tn=Object.entries(sn).map(([s,t])=>{const n=s.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(r=>r.replace(/\[(.+)\]/,":$1")).join("/");return{path:n,element:n!=="/login"?e.jsx(en,{children:e.jsx(t,{})}):e.jsx(t,{})}}),nn=()=>e.jsx(Ys,{children:tn.map(s=>e.jsx(Zs,{path:s.path,element:s.element},s.path))}),rn=new et({defaultOptions:{queries:{retry:!1}}});function an(){return e.jsx(st,{client:rn,children:e.jsx(tt,{children:e.jsx(gt,{children:e.jsx(nn,{})})})})}nt.createRoot(document.getElementById("root")).render(e.jsx(Ge.StrictMode,{children:e.jsx(an,{})}));
