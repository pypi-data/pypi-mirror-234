"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{26704:function(n,e,t){t.r(e),t.d(e,{CONCURRENCY_LIMIT_FRAGMENT:function(){return H},ConcurrencyLimits:function(){return Y},FREE_CONCURRENCY_SLOTS_FOR_RUN_MUTATION:function(){return nn},INSTANCE_CONCURRENCY_LIMITS_QUERY:function(){return W}});var r=t(81862),i=t(58467),c=t(73235),o=t(22970),s=t(52322),l=t(40794),u=t(33379),a=t(60138),d=t(18399),x=t(63832),h=t(28888),f=t(17131),y=t(81308),p=t(92364),m=t(9001),j=t(71897),C=t(12084),g=t(54266),v=t(57830),_=t(37783),b=t(44678),I=t(10952),R=t(34822),S=t(2784),N=t(7267),E=t(19211),k=t(20775),T=t(91195),K=t(55237),w=t(68028),O=t(28252),F=t(6315),L=t(62262),$=t(74897),A=t(4120);function P(){var n=(0,c._)(["\n  fragment ConcurrencyLimitFragment on ConcurrencyKeyInfo {\n    concurrencyKey\n    slotCount\n    activeRunIds\n    activeSlotCount\n  }\n"]);return P=function(){return n},n}function z(){var n=(0,c._)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      info\n      supportsConcurrencyLimits\n      concurrencyLimits {\n        ...ConcurrencyLimitFragment\n      }\n    }\n  }\n\n  ","\n"]);return z=function(){return n},n}function D(){var n=(0,c._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return D=function(){return n},n}function q(){var n=(0,c._)(["\n  mutation FreeConcurrencySlotsForRun($runId: String!) {\n    freeConcurrencySlotsForRun(runId: $runId)\n  }\n"]);return q=function(){return n},n}function J(){var n=(0,c._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          ... on PipelineRun {\n            ...RunTableRunFragment\n          }\n        }\n      }\n      ... on PythonError {\n        ...PythonErrorFragment\n      }\n    }\n  }\n\n  ","\n  ","\n"]);return J=function(){return n},n}var U=S.memo(function(){(0,w.Px)(),(0,O.j)("Concurrency");var n=(0,k.gV)().flagInstanceConcurrencyLimits,e=S.useContext($.N).pageTitle,t=(0,l.a)(W,{notifyOnNetworkStatusChange:!0}),r=(0,K.C4)(t,K.dT),i=t.data,c=i?n?(0,s.jsx)(Y,{instanceConfig:i.instance.info,limits:i.instance.concurrencyLimits,hasSupport:i.instance.supportsConcurrencyLimits,refetch:t.refetch}):(0,s.jsx)(N.l_,{to:"/config"}):(0,s.jsx)(d.x,{padding:{vertical:64},children:(0,s.jsx)(x.$,{purpose:"section"})});return(0,s.jsxs)(h.T,{children:[(0,s.jsx)(f.m,{title:(0,s.jsx)(y.X6,{children:e}),tabs:(0,s.jsx)(A.Z,{tab:"concurrency",refreshState:r})}),c]})});e.default=U;var Y=function(n){var e=n.instanceConfig,t=n.hasSupport,r=n.limits,c=n.refetch,o=(0,i._)(S.useState(),2),l=o[0],u=o[1],a=(0,i._)(S.useState(void 0),2),x=a[0],h=a[1],f=(0,i._)(S.useState(void 0),2),y=f[0],_=f[1],b=S.useCallback(function(){h(void 0),_(void 0)},[_,h]),I=Object.fromEntries(r.map(function(n){return[n.concurrencyKey,n.slotCount]})),R=function(){u({actionType:"add"})},N=function(n){u({actionType:"edit",concurrencyKey:n,concurrencyLimit:I[n]})},E=function(n){u({actionType:"delete",concurrencyKey:n})};return!t&&e&&e.includes("SqliteEventLogStorage")?(0,s.jsx)(d.x,{margin:24,children:(0,s.jsx)(p.t,{icon:"error",title:"No concurrency support",description:"This instance does not support global concurrency limits. You will need to configure a different storage implementation (e.g. Postgres/MySQL) to use this feature."})}):!1===t?(0,s.jsx)(d.x,{margin:24,children:(0,s.jsx)(p.t,{icon:"error",title:"No concurrency support",description:"This instance does not currently support global concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.x,{children:[(0,s.jsx)(d.x,{flex:{justifyContent:"flex-end"},padding:16,children:(0,s.jsx)(m.zx,{intent:"primary",icon:(0,s.jsx)(j.JO,{name:"add_circle"}),onClick:function(){return R()},children:"Add concurrency limit"})}),0===r.length?(0,s.jsx)(p.t,{icon:"error",title:"No concurrency limits",description:(0,s.jsxs)(s.Fragment,{children:["No concurrency limits have been configured for this instance.\xa0",(0,s.jsx)(C.Z,{onClick:function(){return R()},children:"Add a concurrency limit"}),"."]})}):(0,s.jsxs)(g.i,{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{width:"260px"},children:"Concurrency key"}),(0,s.jsx)("th",{style:{width:"20%"},children:"Occupied slots"}),(0,s.jsx)("th",{style:{width:"20%"},children:"Total slots"}),(0,s.jsx)("th",{children:"Active runs"}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:r.map(function(n){return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:n.concurrencyKey}),(0,s.jsx)("td",{children:n.activeSlotCount}),(0,s.jsx)("td",{children:n.slotCount}),(0,s.jsx)("td",{children:0===n.activeRunIds.length?(0,s.jsx)(s.Fragment,{children:"â€”"}):(0,s.jsx)(v.V,{intent:"primary",interactive:!0,children:(0,s.jsxs)(C.Z,{onClick:function(){_(n.concurrencyKey),h(n.activeRunIds)},children:[n.activeRunIds.length," ",1===n.activeRunIds.length?"run":"runs"]})})}),(0,s.jsx)("td",{children:(0,s.jsx)(Z,{concurrencyKey:n.concurrencyKey,onEdit:N,onDelete:E})})]},n.concurrencyKey)})})]})]}),(0,s.jsx)(Q,{open:(null==l?void 0:l.actionType)==="add",onClose:function(){return u(void 0)},onComplete:c}),(0,s.jsx)(B,{concurrencyKey:l&&"delete"===l.actionType?l.concurrencyKey:"",open:(null==l?void 0:l.actionType)==="delete",onClose:function(){return u(void 0)},onComplete:c}),(0,s.jsx)(M,{open:(null==l?void 0:l.actionType)==="edit",onClose:function(){return u(void 0)},onComplete:c,concurrencyKey:(null==l?void 0:l.actionType)==="edit"?l.concurrencyKey:""}),(0,s.jsx)(G,{title:(0,s.jsxs)("span",{children:["Active runs for ",(0,s.jsx)("strong",{children:y})]}),onClose:b,runIds:x})]})},Z=function(n){var e=n.concurrencyKey,t=n.onDelete,r=n.onEdit;return(0,s.jsx)(_.J,{content:(0,s.jsxs)(b.v2,{children:[(0,s.jsx)(b.sN,{icon:"edit",text:"Edit",onClick:function(){return r(e)}}),(0,s.jsx)(b.sN,{icon:"delete",intent:"danger",text:"Delete",onClick:function(){return t(e)}})]}),position:"bottom-left",children:(0,s.jsx)(m.zx,{icon:(0,s.jsx)(j.JO,{name:"expand_more"})})})},V=function(n){if(!n)return!1;var e=parseInt(n);return!isNaN(e)&&String(e)===n.trim()&&e>0&&e<1e3},Q=function(n){var e,t=n.open,c=n.onClose,l=n.onComplete,a=(0,i._)(S.useState(!1),2),x=a[0],h=a[1],f=(0,i._)(S.useState(""),2),y=f[0],p=f[1],j=(0,i._)(S.useState(""),2),C=j[0],g=j[1];S.useEffect(function(){p(""),g("")},[t]);var v=(0,i._)((0,u.D)(X),1)[0],_=(e=(0,r._)(function(){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return h(!0),[4,v({variables:{concurrencyKey:C,limit:parseInt(y.trim())}})];case 1:return n.sent(),h(!1),l(),c(),[2]}})}),function(){return e.apply(this,arguments)});return(0,s.jsxs)(I.Vq,{isOpen:t,title:"Add concurrency limit",onClose:c,children:[(0,s.jsxs)(I.a7,{children:[(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,s.jsx)(d.x,{margin:{bottom:16},children:(0,s.jsx)(R.oi,{value:C||"",onChange:function(n){return g(n.target.value)},placeholder:"Concurrency key"})}),(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,s.jsx)(d.x,{children:(0,s.jsx)(R.oi,{value:y||"",onChange:function(n){return p(n.target.value)},placeholder:"1 - 1000"})})]}),(0,s.jsxs)(I.cN,{children:[(0,s.jsx)(m.zx,{intent:"none",onClick:c,children:"Cancel"}),(0,s.jsx)(m.zx,{intent:"primary",onClick:_,disabled:!V(y.trim())||!C||x,children:x?"Adding...":"Add limit"})]})]})},M=function(n){var e,t=n.concurrencyKey,c=n.open,l=n.onClose,a=n.onComplete,x=(0,i._)(S.useState(!1),2),h=x[0],f=x[1],p=(0,i._)(S.useState(""),2),j=p[0],C=p[1];S.useEffect(function(){C("")},[c]);var g=(0,i._)((0,u.D)(X),1)[0],v=(e=(0,r._)(function(){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return f(!0),[4,g({variables:{concurrencyKey:t,limit:parseInt(j.trim())}})];case 1:return n.sent(),f(!1),a(),l(),[2]}})}),function(){return e.apply(this,arguments)}),_=(0,s.jsxs)(s.Fragment,{children:["Edit ",(0,s.jsx)(y.fv,{children:t})]});return(0,s.jsxs)(I.Vq,{isOpen:c,title:_,onClose:l,children:[(0,s.jsxs)(I.a7,{children:[(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,s.jsx)(d.x,{margin:{bottom:16},children:(0,s.jsx)("strong",{children:t})}),(0,s.jsx)(d.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,s.jsx)(d.x,{children:(0,s.jsx)(R.oi,{value:j||"",onChange:function(n){return C(n.target.value)},placeholder:"1 - 1000"})})]}),(0,s.jsxs)(I.cN,{children:[(0,s.jsx)(m.zx,{intent:"none",onClick:l,children:"Close"}),h?(0,s.jsx)(m.zx,{intent:"primary",disabled:!0,children:"Updating..."}):(0,s.jsx)(m.zx,{intent:"primary",onClick:v,disabled:!V(j.trim()),children:"Update limit"})]})]})},B=function(n){var e,t=n.concurrencyKey,c=n.open,l=n.onClose,a=n.onComplete,d=(0,i._)(S.useState(!1),2),x=d[0],h=d[1],f=(0,i._)((0,u.D)(X),1)[0],p=(e=(0,r._)(function(){return(0,o.Jh)(this,function(n){switch(n.label){case 0:return h(!0),[4,f({variables:{concurrencyKey:t,limit:0}})];case 1:return n.sent(),h(!1),a(),l(),[2]}})}),function(){return e.apply(this,arguments)}),j=(0,s.jsxs)(s.Fragment,{children:["Delete ",(0,s.jsx)(y.fv,{children:t})]});return(0,s.jsxs)(I.Vq,{isOpen:c,title:j,onClose:l,children:[(0,s.jsxs)(I.a7,{children:["Delete concurrency limit\xa0",(0,s.jsx)("strong",{children:t}),"?"]}),(0,s.jsxs)(I.cN,{children:[(0,s.jsx)(m.zx,{intent:"none",onClick:l,children:"Close"}),x?(0,s.jsx)(m.zx,{intent:"danger",disabled:!0,children:"Deleting..."}):(0,s.jsx)(m.zx,{intent:"danger",onClick:p,children:"Delete limit"})]})]})},G=function(n){var e=n.runIds,t=n.onClose,c=n.title,a=(0,l.a)(ne,{variables:{limit:25,filter:{runIds:e||[]}},skip:!e||!e.length}).data,h=(0,i._)((0,u.D)(nn),1)[0],f=S.useCallback(function(n){return F.cv.has(n.status)?[(0,s.jsx)(b.sN,{icon:"status",text:"Free concurrency slots for run",onClick:(0,r._)(function(){var e;return(0,o.Jh)(this,function(r){switch(r.label){case 0:return[4,h({variables:{runId:n.id}})];case 1:if(!(null===(e=r.sent().data)||void 0===e?void 0:e.freeConcurrencySlotsForRun))return[3,3];return[4,(0,E.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"})];case 2:r.sent(),r.label=3;case 3:return t(),[2]}})})},"free-concurrency-slots")]:[]},[h,t]);return(0,s.jsxs)(I.Vq,{isOpen:!!e&&e.length>0,title:c,onClose:t,style:{width:"60%",minWidth:"400px"},children:[(0,s.jsx)(d.x,{padding:{vertical:16},children:a?"Runs"===a.pipelineRunsOrError.__typename?(0,s.jsx)(L.AL,{runs:a.pipelineRunsOrError.results,additionalActionsForRun:f}):(0,s.jsxs)(d.x,{padding:{vertical:64},children:[(0,s.jsx)(p.t,{icon:"error",title:"Query Error",description:"PythonError"===a.pipelineRunsOrError.__typename?a.pipelineRunsOrError.message:"There was a problem querying for these runs."}),";"]}):(0,s.jsx)(d.x,{padding:{vertical:64},children:(0,s.jsx)(x.$,{purpose:"section"})})}),(0,s.jsx)(I.cN,{children:(0,s.jsx)(m.zx,{intent:"none",onClick:t,children:"Close"})})]})},H=(0,a.Ps)(P()),W=(0,a.Ps)(z(),H),X=(0,a.Ps)(D()),nn=(0,a.Ps)(q()),ne=(0,a.Ps)(J(),L.ZZ,T.B)},4120:function(n,e,t){t.d(e,{Z:function(){return g}});var r=t(52322),i=t(18399),c=t(56024),o=t(2784),s=t(20775),l=t(55237),u=t(71897),a=t(86412),d=t(29255),x=t(77334),h=o.memo(function(){var n=o.useContext(d.Z).daemons;return n?(0,r.jsx)(x.a,{content:n.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(u.JO,{name:"warning",color:a.w.Yellow500})}):null}),f=t(43180),y=t(63832),p=o.memo(function(n){var e=n.placeholder,t=o.useContext(d.Z).codeLocations;return t?"spinner"===t.type?(0,r.jsx)(f.u,{content:t.content,placement:"bottom",children:(0,r.jsx)(y.$,{purpose:"body-text",fillColor:a.w.Gray300})}):(0,r.jsx)(x.a,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(u.JO,{name:"warning",color:a.w.Yellow500})}):e?(0,r.jsx)("div",{style:{width:"16px"}}):null}),m=t(40049),j=t(74897),C=t(78945),g=function(n){var e=n.refreshState,t=n.tab,u=o.useContext(j.N).healthTitle,a=(0,C._)(),d=(0,s.gV)().flagInstanceConcurrencyLimits;return(0,r.jsxs)(i.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,r.jsxs)(c.mQ,{selectedTabId:t,children:[(0,r.jsx)(m.f,{id:"locations",title:"Code locations",to:"/locations",icon:(0,r.jsx)(p,{placeholder:!1})}),(0,r.jsx)(m.f,{id:"health",title:u,to:"/health",icon:(0,r.jsx)(h,{})}),a&&d?(0,r.jsx)(m.f,{id:"concurrency",title:"Concurrency limits",to:"/concurrency"}):null,a?(0,r.jsx)(m.f,{id:"config",title:"Configuration",to:"/config"}):null]}),e?(0,r.jsx)(i.x,{padding:{bottom:8},children:(0,r.jsx)(l.xi,{refreshState:e})}):null]})}},78945:function(n,e,t){t.d(e,{_:function(){return s}});var r=t(73235),i=t(40794),c=t(60138);function o(){var n=(0,r._)(["\n  query InstanceConfigHasInfo {\n    instance {\n      id\n      hasInfo\n    }\n  }\n"]);return o=function(){return n},n}var s=function(){var n=(0,i.a)(l).data;return!!(null==n?void 0:n.instance.hasInfo)},l=(0,c.Ps)(o())}}]);
//# sourceMappingURL=704.14ca019961f10df7.js.map